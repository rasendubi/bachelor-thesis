\documentclass[oneside,14pt,a4paper,final]{myextreport}

\usepackage{fontspec}
% polyglossia is an alternative to babel for XeLaTeX
\usepackage{polyglossia}

\defaultfontfeatures{Ligatures={TeX}}
\setmainfont{Times New Roman}
\setsansfont{Comic Sans MS}
\setmonofont{Courier New}

\newfontfamily\cyrillicfont{Times New Roman}
\newfontfamily\cyrillicfonttt{Courier New}

% for some reason polyglossia doesn't define \No itself
\providecommand\No{\char"2116}%{№}%

\setmainlanguage{ukrainian}
\setotherlanguage{english}

% indent first paragraph
\usepackage{indentfirst}

% single space between sentences
\frenchspacing

% enable \url command
\usepackage[hyphens]{url}
% don't create boxes around links
\usepackage[
  colorlinks=false,
  pdfborder={0 0 0},
  % don't create links in table of content
  %
  % This allows dirty hacks
  linktocpage=true,
]{hyperref}

% don't really know, but it should make pages somewhat better
\usepackage{microtype}

% don't allow word overflows
\sloppy

% a half spacing
\linespread{1.5}

% table of acronyms
\usepackage{acronym}

% titles formatting
\usepackage{titlesec}
\titleformat{\chapter}[display]{\filcenter}{\bfseries\MakeUppercase{\chaptertitlename} \thechapter}{0pt}{\bfseries\MakeUppercase}{}
% in case previous setup was right
%\titleformat{\chapter}[hang]{\filcenter}{\bfseries\MakeUppercase{\chaptertitlename} \thechapter. }{0pt}{\bfseries\MakeUppercase}{}

\titleformat{\section}{\normalsize\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection}{1em}{}
\titlespacing*{\chapter}{0pt}{0pt}{\baselineskip}
% these were {*4}{*4}
\titlespacing*{\section}{\parindent}{*2}{*2}
\titlespacing*{\subsection}{\parindent}{*2}{*2}

% Table of content customization
\usepackage{tocloft}

% Don't hyphenate chapter names
\usepackage{hyphenat}

% This block is a dirty hack to make TOC entries uppercase
%
% Well, know when I forked the document class can I make this change in
% the class itself.
\usepackage{etoolbox}
\makeatletter
\patchcmd{\l@chapter}{#1}{\MakeUppercase{\nohyphens{#1}}}{}{}
\makeatother

% Table of content customization
\renewcommand{\cfttoctitlefont}{\hspace{0.38\textwidth} \bfseries\MakeUppercase}
\renewcommand{\cftbeforetoctitleskip}{-1em}
\renewcommand{\cftaftertoctitle}{\vspace{-2.5em}}
\renewcommand{\cftaftertoctitle}{\mbox{}\hfill \\ \mbox{}\hfill Арк.\vspace{-2.5em}}

\renewcommand{\cftchapdotsep}{1}
\renewcommand{\cftchapfont}{}
\renewcommand{\cftchappagefont}{}
\renewcommand{\cftchapleader}{\cftdotfill{\cftchapdotsep}}

\renewcommand{\cftchappresnum}{\MakeUppercase{\chaptername} }
\renewcommand{\cftchapaftersnum}{.\space}
\renewcommand{\cftchapaftersnumb}{}

\newlength{\mylength}
\settowidth\mylength{\cftchappresnum\cftchapaftersnum\space}
\addtolength{\cftchapnumwidth}{\mylength}

%\renewcommand{\cftsecfont}{\hspace{31pt}}
%\renewcommand{\cftsubsecfont}{\hspace{11pt}}
\renewcommand{\cftbeforechapskip}{0mm}
\renewcommand{\cftparskip}{-1mm}
\renewcommand{\cftdotsep}{1}
\setcounter{tocdepth}{2}

% Add bibliography to the toc
\usepackage[nottoc]{tocbibind}

% Set name for bibliography
\AtBeginDocument{\renewcommand\bibname{Список використаних джерел}}

% Redefine a bibliography label
\makeatletter
\renewcommand\@biblabel[1]{#1.}
\makeatother

% Add command for referencing electronic resources
\newcommand{\eresource}[2]{#1. [Електронний ресурс]. --- Режим доступу: \url{#2}}

% text geometry
\hoffset=-1in
\voffset=-1in
% A4: 210 297
% 185 - 20 = 165
\textwidth=165mm
% 287-15 - 20 = 252
\textheight=252mm
% 210(page) - 185(frame) - 5(right margin) + 10(text padding)
\oddsidemargin=30mm
\headheight=14pt
\headsep=10mm
\topmargin=1.5mm

% https://bitbucket.org/fat_angel/opengostfont/downloads
\newfontfamily{\GostA}[
  Path=fonts/,
  SlantedFont=OpenGostTypeA-Regular,
  SlantedFeatures={FakeSlant=0.25},
  Scale=MatchLowercase,
]{OpenGostTypeA-Regular}
\newfontfamily{\GostB}[
  Path=fonts/,
  SlantedFont=OpenGostTypeB-Regular,
  SlantedFeatures={FakeSlant=0.25},
  Scale=0.90
]{OpenGostTypeB-Regular}

% GOST frames
\unitlength=1mm

% renewcommand when stamp code changes
\newcommand\stampcode{}
\newcommand\lastpagelabel{}

\def\VL{\line(0,1){15}}
\def\Box#1#2{\parbox[top][5mm][t]{#1}{\centering #2}}

\newcommand\thin{\linethickness{0.3mm}}
\newcommand\thick{\linethickness{0.5mm}}
\def\firstGrad{\small\noindent\hbox to 0pt{%
    \vbox to 0pt{%
      \noindent\begin{picture}(185,287)(10,0)
      \thick\put(0,0){\framebox(185,287){}}

      \thin \put(0,5){\line(1,0){65}}
      \thin \put(0,10){\line(1,0){65}}
      \thin \put(0,15){\line(1,0){65}}
      \thin \put(0,20){\line(1,0){65}}
      \thick\put(0,25){\line(1,0){185}}
      \thick\put(0,30){\line(1,0){65}}
      \thin \put(0,35){\line(1,0){65}}
      \thick\put(0,40){\line(1,0){185}}

      \thick\put(135,15){\line(1,0){50}}
      \thick\put(135,20){\line(1,0){50}}

      \thick
      \put(7,40){\line(0,-1){15}}
      \put(17,40){\line(0,-1){40}}
      \put(40,40){\line(0,-1){40}}
      \put(55,40){\line(0,-1){40}}
      \put(65,40){\line(0,-1){40}}
      \put(135,25){\line(0,-1){25}}
      \put(150,25){\line(0,-1){10}}
      \put(165,25){\line(0,-1){10}}

      \put(150,15){\Box{15mm}{\sl\GostB \thepage}}
      \put(165,15){\Box{20mm}{\sl\GostB \pageref{\lastpagelabel{}}}}

      \thin
      \put(140,20){\line(0,-1){5}}
      \put(145,20){\line(0,-1){5}}

      \put(65,25){\makebox(120,15){\large\GostA\stampcode}}

      \put(1,0){\Box{17mm}{\raggedright \sl\GostB Затверд.}}
      \put(1,5){\Box{17mm}{\raggedright \sl\GostB Н. Контр.}}
      \put(1,15){\Box{17mm}{\raggedright \sl\GostB Перевір.}}
      \put(1,20){\Box{17mm}{\raggedright \sl\GostB Розроб.}}

      \put(0,25){\Box{7mm}{\sl\GostB Змн.}}
      \put(7,25){\Box{10mm}{\sl\GostB Арк.}}
      \put(17,25){\Box{23mm}{\sl\GostB \No~докум.}}
      \put(40,25){\Box{15mm}{\sl\GostB Підпис}}
      \put(55,25){\Box{10mm}{\sl\GostB Дата}}

      \put(135,20){\Box{15mm}{\sl\GostB Літ.}}
      \put(150,20){\Box{15mm}{\sl\GostB Арк.}}
      \put(165,20){\Box{20mm}{\sl\GostB Аркушів}}
      \end{picture}
    }
  }
}

\def\simpleGrad{\small\noindent\hbox to 0pt{%
    \vbox to 0pt{%
      \noindent\begin{picture}(185,287)(10,0)
      \linethickness{0.5mm}
      \put(0,0){\framebox(185,287){}}
      \put(0,0){\Box{7mm}{\sl\GostB Змн.}}
      \put(0,15){\line(1,0){185}}
      \put(0,5){\line(1,0){65}}
      \linethickness{0.3mm}
      \put(0,10){\line(1,0){65}}
      \linethickness{0.5mm}
      \put(7,0){\VL\Box{10mm}{\sl\GostB Арк.}}
      \put(17,0){\VL\Box{23mm}{\sl\GostB \No~докум.}}
      \put(40,0){\VL\Box{15mm}{\sl\GostB Підпис}}
      \put(55,0){\VL\Box{10mm}{\sl\GostB Дата}}
      \put(65,0){\VL\makebox(110,15){\large\GostA\stampcode}}
      \put(175,8){\parbox[top][7mm][t]{10mm}{\centering \sl\GostB Арк.}}
      \put(175,0){\VL\makebox(10,8){\sl\GostA\normalsize\thepage}}
      \put(175,8){\line(1,0){10}}
      \end{picture}
    }
  }
}

% insert GOST frames into headers
\usepackage{fancyhdr}

\fancypagestyle{plain}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
  \lhead{\firstGrad}
}

\fancypagestyle{normal}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
  \lhead{\simpleGrad}
}

\pagestyle{normal}

\newcommand{\finalizepart}{
  \label{\lastpagelabel{}}
}
\newcommand{\newpart}[2]{
  \finalizepart{}
  \clearpage
  \setcounter{page}{1}
  \enlargethispage{-25mm}
  \renewcommand\stampcode{#2}
  \renewcommand\lastpagelabel{PartLastPage#1}
  \thispagestyle{plain}
}
\AtEndDocument{\finalizepart{}}

\newcommand{\specialchapter}[1]{\chapter*{#1}\addcontentsline{toc}{chapter}{#1}}
\newcommand{\specialsection}[1]{\section*{#1}\addcontentsline{toc}{section}{#1}}

\newcommand{\chapterconslusions}{
  \specialsection{Висновки до розділу \thechapter}
}

\begin{document}

% \chapter{Технічне завдання для дипломного проекту}
% \section{Найменування і область застосування}
% \section{Підстави для розробки}
% \section{Мета і призначення розробки}
% \section{Джерела розробки}
% \section{Технічні вимоги}
% \subsection{Вимоги до розроблюваного продукту}
% \subsection{Вимоги до програмного забезпечення}
% \section{Етапи розробки}

\newpart{part3}{ІАЛЦ.467100.003.ПЗ}
\tableofcontents

\specialchapter{Список скорочень}
\begin{acronym}[TCP/IPA]
  \acro{CAN}{Controller Area Network}
  \acro{CPU}{Central Processing Unit}
  \acro{DOSFS}{FAT-based file system}
  \acro{FPU}{Floating Point Unit}
  \acro{HRFS}{High Reliability File System}
  \acro{IoT}{(Internet of Things) Інтернет Речей}
  \acro{MMU}{Memory Management Unit}
  \acro{NFS}{Network File System}
  \acro{RAM}{Random Access Memory}
  \acro{ROM}{Read-Only Memory}
  \acro{RTOS}{Real-Time Operating System}
  \acro{SLOB}{Simple List of Blocks}
  \acro{SoC}{System on Chip}
  \acro{TCP/IP}{Transport Control Protocol/Internet Protocol}
  \acro{USB}{Universal Serial Bus}
\end{acronym}

\specialchapter{Вступ}

У наші дні активно відбувається мініатюрізація пристроїв, швидкими темпами розвивається Інтернет Речей (Internet of Things, IoT). Гігантськими кроками збільшується кількість пристроїв, що підключені до Інтернету. Експерти оцінюють, що до 2020-го року буде існувати до 50 мільярдів підключених пристроїв\cite{dave-evans:IoT}.

Це означає, що складність програмного забезпечення для вбудованих пристроїв буде зростати, оскільки їм тепер необхідно взаємодіяти з іншими пристроями за допомогою Інтернету, водночас зберігаючи довгу тривалість роботи і надзвичайно низькі вимоги до ресурсів.

Таким чином, вбудовані пристрої вимагають систем управління, що будуть полегшувати організацію складної роботи, зменшувати кількість помилок програміста, і водночас мати мінімальні вимоги до ресурсів процесора і оперативної пам'яті, бути легко переносимими на інші платформи і архітектури.

У рамках даної бакалаврської роботи ставиться завдання розробити систему управління для пристроїв з мінімальним обсягом пам'яті. Головною метою роботи є розробка такої системи для мікроконтроллера STM32F407VGT6, що має має 192 Кб оперативної пам'яті. Однак, система має використовувати мінімум оперативної пам'яті і бути легко портованою на значно менш потужні мікроконтролери. Додатковою метою ставить оцінка сучасних інструментів, зокрема мов програмування, у рамках створення програмного забезпечення для вбудованих пристроїв.

При створенні програмного продукту було пройдено повний цикл його написання -- від постановки завдання, написання технічного завдання і вимог до продукту, до написання програмного забезпечення та тестування.

\chapter{Операційні системи для вбудованих пристроїв}
\section{Загальні положення}

\chapter{Огляд існуючих рішень}
\section{Embedded Linux}

Ядро Linux\cite{linux} пропонує широкий набір функціоналу, серед якого можна знайти безліч драйверів, підтримка великої кількості файлових систем, широкий вибір планувальників і алокаторів пам'яті. Однак, для зниження системних вимог, доводиться відмовлятися від більшості функцій, що надає ядро Лінукс.

Ядро Linux було портовано на велику кількість архітектур, в число яких входять такі як ARM, AVR32, MIPS, Xtensa. Ці архітектури використовуються у вбудованих системах. Однак Linux висуває досить високі вимоги до ресурсів системи. Мінімальний обсяг оперативної пам'яті, що вимагає система, дорівнює 4 мегабайтам, також Лінукс вимагає наявності \ac{MMU}, що перешкоджає його використанню в системах на нижній границі потужностей.

Незважаючи на це, Том Занусі модифікував ядро Лінукс і портував його на Intel Galileo\cite{linux-galileo}. Ця плата базована на мікроконтроллері Intel Quark SoC X1000, що має архітектуру Pentium і 512 кілобайт вбудованої оперативної пам'яті\cite{intel-galileo}.

Ядро розповсюджується під вільною ліцензією GPLv2.

\section{VxWorks}

VxWorks\cite{vxworks} це операційна система реального часу зозроблена як власницьке програмне забезпечення Wind River. VxWorks призначена для вбудованих систем реального часу, що вимагають детермінованої продуктивності, і часто, проходження сертифікації безпеки і захищенності.

VxWorks підтримує архітектури Intel x86, MIPS, PowerPC, Freescale ColdFire, Intel i960, SPARC, Fujitsu FR-V, SH-4, ARM, StrongARM і xScale, і може працювати y режимах симетричної, асиметричної і змішаної багатопроцесорної обробки. Операційна система включає у себе багатозадачне ядро з витісняючим планувальником, засоби міжпроцесорної взаємодії і синхронізації, стек протоколів Bluetooth, \acs{TCP/IP}, \acs{USB}, \acs{CAN}, а також файлові системи \ac{HRFS}, \acs{DOSFS}, \ac{NFS}.

Мінімальний обсяг оперативної пам'яті дорівнює 20-ти кілобайтам.

VxWorks активно використовується в аерокосміній, захисній, автомобільній і робототехнічній галузях. Відомими прикладами використання є марсоходи Sojourner, Spirit, Opportunity\cite{vxworks:rovers}, загальна система ядра Boeing 787 Dreamliner\cite{vxworks:boeing}.

\section{FreeRTOS}

Насьогодні, FreeRTOS\cite{freertos} є найпопулярнішою операційною системою реального часу для вбудованих систем\cite{freertos:popular}. Її було портовано на 35 мікроконтроллерів, що мають наступні архітектури: ARM, AVR, HCS12, MicroBlaze, Cortus, MSP430, PIC, Renesas~ H8/S, SuperH, RX, x86, 8052, Coldfire, V850, 78K0R, Fujitsu MB91460, Nios~ II, TMS570, RM4x.

Це дуже проста операційна система, що складається з чотирьох файлів на мові C. FreeRTOS надає методи для роботи з потоками, м'ютексами і семафорами, таймерами і чергами. Підтримується так званий tickless режим роботи (у цьому режимі переривання таймера відбуваються при нерівних інтервалах, і лише в міру необхідності).

Доступні чотири алокатори пам'яті:
\begin{itemize}
  \item Виділення пам'яті без можливості її звільнення.
  \item Простий алгоритм виділення і звільнення пам'яті без об'єднання вільних ділянок.
  \item Більш складний і швидкий алгоритм виділення і звільнення пам'яті з об'єднанням вільних ділянок.
  \item Обгортки навколо стандартної бібліотеки, що забезпечують взаємне виключення.
\end{itemize}

FreeRTOS має надзвичайно низькі вимоги до оперативної пам'яті. Планувальник вимагає 236 байт оперативної пам'яті, плюс 76 байти для кожної черги і 64 байти для кожної задачі.

Ядро розповсюджується під модифікованою вільною ліцензією GPLv2\cite{freertos:license}. Модифікація дозволяє залишати закритим код додатків, що використовують FreeRTOS і розповсюджуються у вигляді виконуваного коду, а також забороняє використання FreeRTOS у еталонних теста. Також доступна комерційна підтримка і ліцензія під ім'ям OpenRTOS\cite{openrtos}.

\section{QNX Neutrino}

QNX\cite{qnx} це комерційна Unix-подібна операційна система спрямована в першу чергу на вбудовані системи. Операційна система має мікроядерну архітектуру. QNX Neutrino була портована на велику кількість платформ і працює на Intel 8088, x86, MIPS, PowerPC, SH-4, ARM, StrongARM, XScale.

Ядро QNX містить лише планувальник задач, міжпроцесну взаємодію, перенаправлення переривань і таймери. Все інше виконується як процеси рівня користувача, включаючи керування пам'яттю.

QNX має закриту ліцензію, але також має окрему ліцензію для академічного і некомерційного використання\cite{qnx:noncommercial}.

% \section{Contiki}

\chapter{Аналіз і вибір мови програмування}
\section{Загальні вимоги}
\section{C}
\section{C++}
\section{Idris}
\section{Nim}
\section{Rust}
\chapterconslusions{}

\begin{thebibliography}{00}
  \bibitem{linux}
    \eresource{Linux.com | The source for Linux information}{https://linux.com/}
  \bibitem{linux-galileo}
    \eresource{microYocto and the Internet of Tiny}{http://events.linuxfoundation.org/sites/events/files/slides/tom.zanussi-elc2014.pdf}
  \bibitem{intel-galileo}
    \eresource{Galileo Feature Sheet}{http://www.intel.com/content/dam/support/us/en/documents/galileo/sb/galileo\_datasheet\_329681\_003.pdf}

  \bibitem{freertos}
    \eresource{FreeRTOS - Market leading RTOS (Real Time Operating System) for embedded systems with Internet of Things extensions}{http://www.freertos.org/}
  \bibitem{freertos:popular}
    \eresource{Android, FreeRTOS top EE Times' 2013 embedded survey}{http://www.eetimes.com/document.asp?doc\_id=1263083}
  \bibitem{freertos:license}
    \eresource{FreeRTOS License}{http://www.freertos.org/license.txt}
  \bibitem{openrtos}
    \eresource{OPENRTOS, part of embedded FreeRTOS -- OpenRTOS -- SafeRTOS family}{http://www.highintegritysystems.com/openrtos/}

  \bibitem{vxworks}
    \eresource{VxWorks}{http://windriver.com/products/vxworks/}
  \bibitem{vxworks:rovers}
    \eresource{Inside NASA's Curiosity: It's an Apple Airport Extreme... with wheels | ExtremeTech}{http://www.extremetech.com/extreme/134041-inside-nasas-curiosity-its-an-apple-airport-extreme-with-wheels}
  \bibitem{vxworks:boeing}
    \eresource{787 Dreamliner (Common Core Systems) | Customers | AdaCore}{http://www.adacore.com/customers/787-dreamliner-common-core-system/}

  \bibitem{qnx}
    \eresource{QNX Neutrino RTOS}{http://www.qnx.com/products/neutrino-rtos/neutrino-rtos.html}
  \bibitem{qnx:noncommercial}
    \eresource{QNX Neutrino Realtime Operating System}{http://www.qnx.com/download/download.html?dlc=proc&newsearch=yes&searchme=non-commercial&p=1&sort=bydate&sorttype=desc&searchdate=alltime}

  \bibitem{dave-evans:IoT}
    \eresource{The Internet of Things. How the Next Evolution of the Internet is Changing Everything}{http://www.cisco.com/c/dam/en\_us/about/ac79/docs/innov/IoT\_IBSG\_0411FINAL.pdf}
\end{thebibliography}

\end{document}
